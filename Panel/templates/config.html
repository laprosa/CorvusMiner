{{define "content"}}
<div class="config-page">
    <h2 style="color: #aa0000; letter-spacing: 2px; margin-bottom: 15px;">CONFIGURATION</h2>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1200px;">
        <!-- CPU Configuration Builder -->
        <div class="config-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="color: #aa0000; font-size: 1em; letter-spacing: 1px; margin: 0;">CPU</h3>
                <label style="color: #b3b3b3; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="cpuEnabled" {{if eq .enableCPU 1}}checked{{end}} style="
                        margin-right: 8px;
                        cursor: pointer;
                        width: 18px;
                        height: 18px;
                    ">
                    Enable
                </label>
            </div>
            <div class="form-group" style="margin-bottom: 10px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Mining URL:</label>
                <input type="text" id="cpuMiningUrl" value="{{.cpuConfig.MiningURL}}" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Wallet:</label>
                <input type="text" id="cpuWallet" value="{{.cpuConfig.Wallet}}" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Password:</label>
                <input type="text" id="cpuPassword" value="{{.cpuConfig.Password}}" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Non-Idle Usage (%):</label>
                <input type="number" id="cpuNonIdleUsage" value="{{.cpuConfig.NonIdleUsage}}" min="0" max="100" step="0.1" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Idle Usage (%):</label>
                <input type="number" id="cpuIdleUsage" value="{{.cpuConfig.IdleUsage}}" min="0" max="100" step="0.1" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Wait Time Idle (seconds):</label>
                <input type="number" id="cpuWaitTimeIdle" value="{{.cpuConfig.WaitTimeIdle}}" min="0" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="cpuUseSSL" {{if eq .cpuConfig.UseSSL 1}}checked{{end}} style="
                        margin-right: 8px;
                        cursor: pointer;
                    ">
                    Enable SSL/TLS
                </label>
            </div>
            <div style="background-color: #262626; border: 2px solid #440000; padding: 10px; margin-top: 10px; min-height: 100px;">
                <p style="color: #aa0000; margin-bottom: 5px; font-size: 0.9em;">Generated JSON:</p>
                <textarea id="cpuJsonOutput" readonly style="
                    width: 100%;
                    height: 80px;
                    padding: 5px;
                    background-color: #1a1a1a;
                    color: #b3b3b3;
                    border: 1px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.8em;
                    resize: none;
                "></textarea>
            </div>
        </div>

        <!-- GPU Configuration Builder -->
        <div class="config-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="color: #aa0000; font-size: 1em; letter-spacing: 1px; margin: 0;">GPU</h3>
                <label style="color: #b3b3b3; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gpuEnabled" {{if eq .enableGPU 1}}checked{{end}} style="
                        margin-right: 8px;
                        cursor: pointer;
                        width: 18px;
                        height: 18px;
                    ">
                    Enable
                </label>
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Algorithm:</label>
                <select id="gpuAlgo" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
                    <option value="ethash" {{if eq .gpuConfig.Algo "ethash"}}selected{{end}}>Ethash (eth, 2%)</option>
                    <option value="etchash" {{if eq .gpuConfig.Algo "etchash"}}selected{{end}}>Etchash (etc, 2%)</option>
                    <option value="kawpow" {{if eq .gpuConfig.Algo "kawpow"}}selected{{end}}>KawPow (rvn, ravencoin, 2%)</option>
                    <option value="autolykos2" {{if eq .gpuConfig.Algo "autolykos2"}}selected{{end}}>Autolykos2 (ergo, 2%)</option>
                    <option value="kheavyhash" {{if eq .gpuConfig.Algo "kheavyhash"}}selected{{end}}>KHeavyHash (kaspa, 1%)</option>
                    <option value="cortex" {{if eq .gpuConfig.Algo "cortex"}}selected{{end}}>Cortex (5%)</option>
                    <option value="beamhash" {{if eq .gpuConfig.Algo "beamhash"}}selected{{end}}>BeamHash (2%)</option>
                    <option value="equihash144_5" {{if eq .gpuConfig.Algo "equihash144_5"}}selected{{end}}>Equihash144_5 (2%)</option>
                    <option value="equihash125_4" {{if eq .gpuConfig.Algo "equihash125_4"}}selected{{end}}>Equihash125_4 (2%)</option>
                    <option value="equihash210_9" {{if eq .gpuConfig.Algo "equihash210_9"}}selected{{end}}>Equihash210_9 (2%)</option>
                    <option value="cuckoo29" {{if eq .gpuConfig.Algo "cuckoo29"}}selected{{end}}>Cuckoo29 (aeternity, 2%)</option>
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 10px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Mining URL:</label>
                <input type="text" id="gpuMiningUrl" value="{{.gpuConfig.MiningURL}}" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Wallet:</label>
                <input type="text" id="gpuWallet" value="{{.gpuConfig.Wallet}}" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Password:</label>
                <input type="text" id="gpuPassword" value="{{.gpuConfig.Password}}" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Fan Speed (%):</label>
                <input type="number" id="gpuFanSpeed" value="{{.gpuConfig.FanSpeed}}" min="0" max="100" step="1" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: block; margin-bottom: 5px;">Wait Time Idle (seconds):</label>
                <input type="number" id="gpuWaitTimeIdle" value="{{.gpuConfig.WaitTimeIdle}}" min="0" style="
                    width: 100%;
                    padding: 5px;
                    background-color: #262626;
                    color: #b3b3b3;
                    border: 2px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.9em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label style="color: #b3b3b3; display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gpuUseSSL" {{if eq .gpuConfig.UseSSL 1}}checked{{end}} style="
                        margin-right: 8px;
                        cursor: pointer;
                    ">
                    Enable SSL/TLS
                </label>
            </div>
            <div style="background-color: #262626; border: 2px solid #440000; padding: 10px; margin-top: 10px; min-height: 100px;">
                <p style="color: #aa0000; margin-bottom: 5px; font-size: 0.9em;">Generated JSON:</p>
                <textarea id="gpuJsonOutput" readonly style="
                    width: 100%;
                    height: 80px;
                    padding: 5px;
                    background-color: #1a1a1a;
                    color: #b3b3b3;
                    border: 1px solid #440000;
                    font-family: 'Ubuntu Mono', monospace;
                    font-size: 0.8em;
                    resize: none;
                "></textarea>
            </div>
        </div>
    </div>

    <!-- Save Button -->
    <div style="margin-top: 15px; max-width: 1200px;">
        <button onclick="saveConfig()" style="
            background-color: #aa0000;
            color: white;
            border: 2px solid #aa0000;
            padding: 8px 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Ubuntu Mono', monospace;
            transition: all 0.3s;
            letter-spacing: 1px;
        " onmouseover="this.style.backgroundColor='transparent'; this.style.color='#aa0000';" onmouseout="this.style.backgroundColor='#aa0000'; this.style.color='white';">
            SET CONFIGURATION
        </button>
    </div>

    <div id="statusMessage" style="margin-top: 10px; font-size: 0.95em; color: #00aa55; display: none;"></div>
</div>

<script>
function buildJsonForCpu() {
    const config = {
        mining_url: document.getElementById('cpuMiningUrl').value,
        wallet: document.getElementById('cpuWallet').value,
        password: document.getElementById('cpuPassword').value,
        non_idle_usage: parseFloat(document.getElementById('cpuNonIdleUsage').value) || 0,
        idle_usage: parseFloat(document.getElementById('cpuIdleUsage').value) || 0,
        wait_time_idle: parseInt(document.getElementById('cpuWaitTimeIdle').value) || 0,
        use_ssl: document.getElementById('cpuUseSSL').checked ? 1 : 0
    };
    document.getElementById('cpuJsonOutput').value = JSON.stringify(config, null, 2);
}

function buildJsonForGpu() {
    const config = {
        mining_url: document.getElementById('gpuMiningUrl').value,
        wallet: document.getElementById('gpuWallet').value,
        password: document.getElementById('gpuPassword').value,
        algo: document.getElementById('gpuAlgo').value,
        fan_speed: parseInt(document.getElementById('gpuFanSpeed').value) || 80,
        wait_time_idle: parseInt(document.getElementById('gpuWaitTimeIdle').value) || 0,
        use_ssl: document.getElementById('gpuUseSSL').checked ? 1 : 0
    };
    document.getElementById('gpuJsonOutput').value = JSON.stringify(config, null, 2);
}

function saveConfig() {
    try {
        buildJsonForCpu();
        buildJsonForGpu();

        const cpuData = JSON.parse(document.getElementById('cpuJsonOutput').value);
        const gpuData = JSON.parse(document.getElementById('gpuJsonOutput').value);

        // Construct config object with separate CPU and GPU settings
        const config = {
            cpu_mining_url: cpuData.mining_url,
            cpu_wallet: cpuData.wallet,
            cpu_password: cpuData.password,
            cpu_non_idle_usage: cpuData.non_idle_usage,
            cpu_idle_usage: cpuData.idle_usage,
            cpu_use_ssl: cpuData.use_ssl,
            cpu_enabled: document.getElementById('cpuEnabled').checked,
            gpu_mining_url: gpuData.mining_url,
            gpu_wallet: gpuData.wallet,
            gpu_password: gpuData.password,
            gpu_algo: gpuData.algo,
            gpu_fan_speed: gpuData.fan_speed,
            gpu_use_ssl: gpuData.use_ssl,
            gpu_enabled: document.getElementById('gpuEnabled').checked,
            wait_time_idle: cpuData.wait_time_idle
        };

        // Send to backend
        fetch('/api/config/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(config)
        })
        .then(response => response.json())
        .then(data => {
            const msg = document.getElementById('statusMessage');
            if (data.success) {
                msg.textContent = 'Configuration saved successfully!';
                msg.style.color = '#00aa55';
                msg.style.display = 'block';
                setTimeout(() => { msg.style.display = 'none'; }, 3000);
            } else {
                msg.textContent = 'Error saving configuration: ' + (data.error || 'Unknown error');
                msg.style.color = '#aa3333';
                msg.style.display = 'block';
            }
        })
        .catch(error => {
            const msg = document.getElementById('statusMessage');
            msg.textContent = 'Error: ' + error.message;
            msg.style.color = '#aa3333';
            msg.style.display = 'block';
        });
    } catch (error) {
        const msg = document.getElementById('statusMessage');
        msg.textContent = 'Error: ' + error.message;
        msg.style.color = '#aa3333';
        msg.style.display = 'block';
    }
}

// Build JSON on load and add event listeners
document.addEventListener('DOMContentLoaded', function() {
    buildJsonForCpu();
    buildJsonForGpu();

    // Add event listeners to rebuild JSON on input change
    document.getElementById('cpuMiningUrl').addEventListener('input', buildJsonForCpu);
    document.getElementById('cpuWallet').addEventListener('input', buildJsonForCpu);
    document.getElementById('cpuPassword').addEventListener('input', buildJsonForCpu);
    document.getElementById('cpuAlgo').addEventListener('change', buildJsonForCpu);
    document.getElementById('cpuNonIdleUsage').addEventListener('input', buildJsonForCpu);
    document.getElementById('cpuIdleUsage').addEventListener('input', buildJsonForCpu);
    document.getElementById('cpuWaitTimeIdle').addEventListener('input', buildJsonForCpu);
    document.getElementById('cpuUseSSL').addEventListener('change', buildJsonForCpu);
    document.getElementById('cpuEnabled').addEventListener('change', saveConfig);

    document.getElementById('gpuMiningUrl').addEventListener('input', buildJsonForGpu);
    document.getElementById('gpuWallet').addEventListener('input', buildJsonForGpu);
    document.getElementById('gpuPassword').addEventListener('input', buildJsonForGpu);
    document.getElementById('gpuAlgo').addEventListener('change', buildJsonForGpu);
    document.getElementById('gpuFanSpeed').addEventListener('input', buildJsonForGpu);
    document.getElementById('gpuWaitTimeIdle').addEventListener('input', buildJsonForGpu);
    document.getElementById('gpuUseSSL').addEventListener('change', buildJsonForGpu);
    document.getElementById('gpuEnabled').addEventListener('change', saveConfig);
});
</script>
{{end}}
